<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kniha J√°zd">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="Mobiln√° evidencia slu≈æobn√Ωch a s√∫kromn√Ωch ciest">
    
    <title>Kniha J√°zd 2025</title>
    
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' fill='%23667eea' rx='40'/%3E%3Ctext x='96' y='130' font-size='100' text-anchor='middle' fill='white'%3Eüöó%3C/text%3E%3C/svg%3E">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: env(safe-area-inset-top, 15px) env(safe-area-inset-right, 15px) env(safe-area-inset-bottom, 15px) env(safe-area-inset-left, 15px);
            font-size: 16px;
            overscroll-behavior: none;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .header {
            position: relative;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 14px;
        }

        .install-banner {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 12px;
        }

        .install-banner-content {
            flex: 1;
        }

        .install-banner-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .install-banner-text {
            font-size: 13px;
            opacity: 0.95;
        }

        .install-btn {
            background: white;
            color: #28a745;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
        }

        .close-banner {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0 5px;
            line-height: 1;
        }

        .status-bar {
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #1565c0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4caf50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .form-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        select {
            background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E") no-repeat right 12px center;
            padding-right: 35px;
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #28a745;
            color: white;
        }

        .btn-tertiary {
            background: #17a2b8;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .records {
            margin-top: 30px;
        }

        .record-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            position: relative;
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .record-date {
            font-weight: 600;
            color: #667eea;
        }

        .record-delete {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .record-info {
            font-size: 13px;
            color: #555;
            line-height: 1.6;
        }

        .info-section {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #1565c0;
        }

        .counter {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin: 15px 0;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.9;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .row {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr;
            }
        }

        .backup-section {
            margin-top: 20px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
        }

        .backup-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 10px;
        }

        .backup-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöó Kniha J√°zd</h1>
            <p class="subtitle">2025 - Mobiln√° aplik√°cia</p>
        </div>

        <div id="installBanner" class="install-banner">
            <div class="install-banner-content">
                <div class="install-banner-title">üì± Nain≈°taluj aplik√°ciu</div>
                <div class="install-banner-text">Pridaj na plochu pre r√Ωchly pr√≠stup</div>
            </div>
            <button id="installBtn" class="install-btn">In≈°talova≈•</button>
            <button id="closeBanner" class="close-banner">&times;</button>
        </div>

        <div class="status-bar">
            <div class="status-indicator"></div>
            <span id="statusText">Aplik√°cia funguje offline</span>
        </div>

        <div class="info-section">
            ‚ÑπÔ∏è Vypl≈à √∫daje o ceste a pridaj do zoznamu. V≈°etko sa uklad√° lok√°lne v telef√≥ne.
        </div>

        <form id="jazzForm">
            <div class="row">
                <div class="form-group">
                    <label>D√°tum odchodu *</label>
                    <input type="date" id="datumOdchodu" required>
                </div>
                <div class="form-group">
                    <label>D√°tum pr√≠chodu *</label>
                    <input type="date" id="datumPrichodu" required>
                </div>
            </div>

            <div class="form-group">
                <label>Meno a priezvisko *</label>
                <input type="text" id="meno" placeholder="J√°n Nov√°k" required>
            </div>

            <div class="form-group">
                <label>Trasa *</label>
                <input type="text" id="trasa" placeholder="Bratislava - Ko≈°ice" required>
            </div>

            <div class="form-group">
                <label>√öƒçel cesty *</label>
                <select id="ucel" required>
                    <option value="">-- Vyber √∫ƒçel --</option>
                    <option value="pracovn√° cesta">Pracovn√° cesta</option>
                    <option value="testovanie">Testovanie</option>
                    <option value="s√∫kromn√© vyu≈æitie">S√∫kromn√© vyu≈æitie</option>
                </select>
            </div>

            <div class="row">
                <div class="form-group">
                    <label>Stav tachometra - zaƒçiatok (km) *</label>
                    <input type="number" id="kmZaciatok" step="0.1" placeholder="12345" required>
                </div>
                <div class="form-group">
                    <label>Stav tachometra - koniec (km) *</label>
                    <input type="number" id="kmKoniec" step="0.1" placeholder="12545" required>
                </div>
            </div>

            <div class="form-group">
                <label>Poƒçet najazden√Ωch km</label>
                <input type="number" id="kmCelkom" step="0.1" readonly style="background: #f0f0f0;">
            </div>

            <div class="form-group">
                <label>Energy (kWh)</label>
                <input type="number" id="kwh" step="0.01" placeholder="0.00">
            </div>

            <div class="row">
                <div class="form-group">
                    <label>EUR (s DPH) /kWh</label>
                    <input type="number" id="eurSDPH" step="0.0001" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>EUR (bez DPH) /kWh</label>
                    <input type="number" id="eurBezDPH" step="0.0001" placeholder="0.00">
                </div>
            </div>

            <div class="form-group">
                <label>Natankovan√© litre</label>
                <input type="number" id="litre" step="0.01" placeholder="0.00">
            </div>

            <div class="row">
                <div class="form-group">
                    <label>EUR za L s DPH</label>
                    <input type="number" id="eurZaLSDPH" step="0.01" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>EUR (bez DPH) /L</label>
                    <input type="number" id="eurBezDPHL" step="0.01" placeholder="0.00">
                </div>
            </div>

            <div class="row">
                <div class="form-group">
                    <label>Stav n√°dr≈æe - zaƒçiatok (%)</label>
                    <input type="number" id="nadrzZaciatok" min="0" max="100" placeholder="50">
                </div>
                <div class="form-group">
                    <label>Stav n√°dr≈æe - koniec (%)</label>
                    <input type="number" id="nadrzKoniec" min="0" max="100" placeholder="30">
                </div>
            </div>

            <div class="form-group">
                <label>Pozn√°mky</label>
                <textarea id="poznamky" placeholder="Dodatoƒçn√© inform√°cie..."></textarea>
            </div>

            <button type="submit" class="btn btn-primary">‚ûï Prida≈• z√°znam</button>
        </form>

        <div class="records">
            <div class="stats" id="statsSection" style="display: none;">
                <div class="stat-box">
                    <div class="stat-value" id="totalTrips">0</div>
                    <div class="stat-label">Cesty</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalKm">0</div>
                    <div class="stat-label">Celkom KM</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalKwh">0</div>
                    <div class="stat-label">Celkom kWh</div>
                </div>
            </div>

            <div class="counter">
                Poƒçet z√°znamov: <strong id="recordCount">0</strong>
            </div>
            <div id="recordsList"></div>
            
            <button onclick="exportToExcel()" class="btn btn-secondary" id="exportBtn" style="display: none;">
                üì• Exportova≈• do Excel
            </button>
            
            <div class="backup-section" id="backupSection" style="display: none;">
                <div class="backup-title">üíæ Z√°loha d√°t</div>
                <div class="backup-buttons">
                    <button onclick="exportBackup()" class="btn btn-warning">üì§ Exportova≈• JSON</button>
                    <button onclick="importBackup()" class="btn btn-warning">üì• Importova≈• JSON</button>
                </div>
                <input type="file" id="fileInput" accept=".json" style="display: none;">
            </div>
            
            <button onclick="clearAll()" class="btn btn-tertiary" id="clearBtn" style="display: none;">
                üóëÔ∏è Vymaza≈• v≈°etko
            </button>
        </div>

        <div class="loading" id="loading">
            Generujem Excel s√∫bor...
        </div>
    </div>

    <script>
        let deferredPrompt;
        let records = JSON.parse(localStorage.getItem('knihaJazdRecords')) || [];

        // Registr√°cia Service Workera
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => {
                        console.log('Service Worker registrovan√Ω', reg);
                        updateStatus('‚úì Aplik√°cia je pripraven√° offline');
                    })
                    .catch(err => console.log('Service Worker zlyhal:', err));
            });
        }

        // PWA in≈°tal√°cia
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBanner').style.display = 'flex';
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                document.getElementById('installBanner').style.display = 'none';
                updateStatus('‚úì Aplik√°cia nain≈°talovan√°');
            }
            deferredPrompt = null;
        });

        document.getElementById('closeBanner').addEventListener('click', () => {
            document.getElementById('installBanner').style.display = 'none';
        });

        window.addEventListener('appinstalled', () => {
            updateStatus('‚úì Aplik√°cia √∫spe≈°ne nain≈°talovan√°');
        });

        function updateStatus(text) {
            document.getElementById('statusText').textContent = text;
        }

        // Nastavenie dne≈°n√©ho d√°tumu
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('datumOdchodu').value = today;
            document.getElementById('datumPrichodu').value = today;
            displayRecords();
            updateStats();
        });

        // Automatick√Ω v√Ωpoƒçet km
        document.getElementById('kmZaciatok').addEventListener('input', calculateKm);
        document.getElementById('kmKoniec').addEventListener('input', calculateKm);

        function calculateKm() {
            const start = parseFloat(document.getElementById('kmZaciatok').value) || 0;
            const end = parseFloat(document.getElementById('kmKoniec').value) || 0;
            const total = Math.max(0, end - start);
            document.getElementById('kmCelkom').value = total.toFixed(1);
        }

        document.getElementById('jazzForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const record = {
                id: Date.now(),
                datumOdchodu: document.getElementById('datumOdchodu').value,
                datumPrichodu: document.getElementById('datumPrichodu').value,
                meno: document.getElementById('meno').value,
                trasa: document.getElementById('trasa').value,
                ucel: document.getElementById('ucel').value,
                kmZaciatok: parseFloat(document.getElementById('kmZaciatok').value),
                kmKoniec: parseFloat(document.getElementById('kmKoniec').value),
                kmCelkom: parseFloat(document.getElementById('kmCelkom').value),
                kwh: parseFloat(document.getElementById('kwh').value) || 0,
                eurSDPH: parseFloat(document.getElementById('eurSDPH').value) || 0,
                eurBezDPH: parseFloat(document.getElementById('eurBezDPH').value) || 0,
                litre: parseFloat(document.getElementById('litre').value) || 0,
                eurZaLSDPH: parseFloat(document.getElementById('eurZaLSDPH').value) || 0,
                eurBezDPHL: parseFloat(document.getElementById('eurBezDPHL').value) || 0,
                nadrzZaciatok: parseInt(document.getElementById('nadrzZaciatok').value) || 0,
                nadrzKoniec: parseInt(document.getElementById('nadrzKoniec').value) || 0,
                poznamky: document.getElementById('poznamky').value
            };

            records.push(record);
            localStorage.setItem('knihaJazdRecords', JSON.stringify(records));
            
            displayRecords();
            updateStats();
            this.reset();
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('datumOdchodu').value = today;
            document.getElementById('datumPrichodu').value = today;
            
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            
            // Vibr√°cia ak je podporovan√°
            if ('vibrate' in navigator) {
                navigator.vibrate(50);
            }
        });

        function updateStats() {
            if (records.length === 0) {
                document.getElementById('statsSection').style.display = 'none';
                return;
            }

            document.getElementById('statsSection').style.display = 'grid';
            
            const totalKm = records.reduce((sum, r) => sum + (r.kmCelkom || 0), 0);
            const totalKwh = records.reduce((sum, r) => sum + (r.kwh || 0), 0);
            
            document.getElementById('totalTrips').textContent = records.length;
            document.getElementById('totalKm').textContent = totalKm.toFixed(0);
            document.getElementById('totalKwh').textContent = totalKwh.toFixed(1);
        }

        function displayRecords() {
            const recordsList = document.getElementById('recordsList');
            const recordCount = document.getElementById('recordCount');
            const exportBtn = document.getElementById('exportBtn');
            const clearBtn = document.getElementById('clearBtn');
            const backupSection = document.getElementById('backupSection');
            
            recordCount.textContent = records.length;
            
            if (records.length === 0) {
                recordsList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Zatiaƒæ ≈æiadne z√°znamy</p>';
                exportBtn.style.display = 'none';
                clearBtn.style.display = 'none';
                backupSection.style.display = 'none';
                return;
            }

            exportBtn.style.display = 'block';
            clearBtn.style.display = 'block';
            backupSection.style.display = 'block';
            
            recordsList.innerHTML = records.map(record => `
                <div class="record-item">
                    <div class="record-header">
                        <span class="record-date">${formatDate(record.datumOdchodu)}</span>
                        <button onclick="deleteRecord(${record.id})" class="record-delete">Zmaza≈•</button>
                    </div>
                    <div class="record-info">
                        <strong>${record.meno}</strong><br>
                        ${record.trasa} (${record.ucel})<br>
                        KM: ${record.kmZaciatok} ‚Üí ${record.kmKoniec} = <strong>${record.kmCelkom} km</strong><br>
                        ${record.kwh > 0 ? `‚ö° ${record.kwh} kWh` : ''}
                        ${record.litre > 0 ? `‚õΩ ${record.litre} L` : ''}
                        ${record.poznamky ? `<br>üìù ${record.poznamky}` : ''}
                    </div>
                </div>
            `).reverse().join('');
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('sk-SK');
        }

        function deleteRecord(id) {
            if (confirm('Naozaj chce≈° zmaza≈• tento z√°znam?')) {
                records = records.filter(r => r.id !== id);
                localStorage.setItem('knihaJazdRecords', JSON.stringify(records));
                displayRecords();
                updateStats();
                
                if ('vibrate' in navigator) {
                    navigator.vibrate([50, 100, 50]);
                }
            }
        }

        function clearAll() {
            if (confirm('Naozaj chce≈° zmaza≈• v≈°etky z√°znamy? T√°to akcia sa ned√° vr√°ti≈•!')) {
                records = [];
                localStorage.removeItem('knihaJazdRecords');
                displayRecords();
                updateStats();
            }
        }

        function exportToExcel() {
            if (records.length === 0) {
                alert('Nie s√∫ ≈æiadne z√°znamy na export!');
                return;
            }

            document.getElementById('loading').style.display = 'block';

            setTimeout(() => {
                const wb = XLSX.utils.book_new();
                
                const wsData = [
                    ['Kniha J√°zd od 01.01.2025 do 31.12.2025'],
                    ['', '', '', '', 'IƒåO:', '', '', '', 'Rok: 2025', '', '', '', '', '', '', '', '', '', 'D≈àa:'],
                    [],
                    [],
                    ['Vozidlo:', 'firemne'],
                    ['Typ:', 'Auto 1', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', 'Normovan√° spotreba:', '', '', '19,92 kWh/ 100km'],
                    ['PHM:', 'KWH', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', 'Normovan√° spotreba + 20%:'],
                    [],
                    ['D√°tum', 'D√°tum', '', '', '', '', '', '', '', 'Dob√≠janie', '', '', 'Tankovanie', '', '', '', '', '', 'S√∫kr.', 'N√°hrada', 'N√°hrada', 'Uplatniteƒæn√°'],
                    ['odchodu', 'pr√≠chodu', 'Meno a Priezvisko', 'Trasa', '√öƒçel pracovn√° cesta testovanie sukromne vyu≈æitie', 'stav tachometra v km na zaƒçiatku cesty', 'stav tachometra v km na konci cesty', 'poƒçet najazdenych km', 'Energy (kWh)', 'EUR (s DPH) /kWh', 'EUR (bez DPH) /kWh', '', 'natankovane Litre', 'EUR (s DPH) /L (sum cely blok)', 'EUR za L s DPH', 'EUR (bez DPH) /L', 'pribli≈æny stav n√°dr≈æe na zaƒçiatku cesty', 'pribli≈æny stav n√°dr≈æe na konci cesty', 'Km.', 'za PHM', 'za km', 'n√°hrada', 'poznamky √∫ƒçtovn√© oddelenie']
                ];

                records.forEach(record => {
                    wsData.push([
                        record.datumOdchodu,
                        record.datumPrichodu,
                        record.meno,
                        record.trasa,
                        record.ucel,
                        record.kmZaciatok,
                        record.kmKoniec,
                        record.kmCelkom,
                        record.kwh || '',
                        record.eurSDPH || '',
                        record.eurBezDPH || '',
                        '',
                        record.litre || '',
                        '',
                        record.eurZaLSDPH || '',
                        record.eurBezDPHL || '',
                        record.nadrzZaciatok || '',
                        record.nadrzKoniec || '',
                        '',
                        0.00,
                        '',
                        0.00,
                        record.poznamky || ''
                    ]);
                });

                const ws = XLSX.utils.aoa_to_sheet(wsData);
                
                ws['!cols'] = [
                    {wch: 12}, {wch: 12}, {wch: 20}, {wch: 25}, {wch: 25},
                    {wch: 12}, {wch: 12}, {wch: 12}, {wch: 12}, {wch: 12},
                    {wch: 12}, {wch: 5}, {wch: 12}, {wch: 12}, {wch: 12},
                    {wch: 12}, {wch: 12}, {wch: 12}, {wch: 10}, {wch: 10},
                    {wch: 10}, {wch: 12}, {wch: 25}
                ];

                XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
                
                const dateStr = new Date().toISOString().split('T')[0];
                const filename = `kniha_jazd_${dateStr}.xlsx`;
                
                XLSX.writeFile(wb, filename);
                
                document.getElementById('loading').style.display = 'none';
                
                if ('vibrate' in navigator) {
                    navigator.vibrate(200);
                }
                
                alert('‚úÖ Excel s√∫bor bol √∫spe≈°ne exportovan√Ω!');
            }, 300);
        }

        // Funkcie pre z√°lohovanie
        function exportBackup() {
            const dataStr = JSON.stringify(records, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `kniha_jazd_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            if ('vibrate' in navigator) {
                navigator.vibrate(100);
            }
        }

        function importBackup() {
            document.getElementById('fileInput').click();
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const importedRecords = JSON.parse(event.target.result);
                    if (confirm(`Importova≈• ${importedRecords.length} z√°znamov? S√∫ƒçasn√© z√°znamy bud√∫ nahraden√©.`)) {
                        records = importedRecords;
                        localStorage.setItem('knihaJazdRecords', JSON.stringify(records));
                        displayRecords();
                        updateStats();
                        alert('‚úÖ Z√°znamy √∫spe≈°ne importovan√©!');
                        
                        if ('vibrate' in navigator) {
                            navigator.vibrate(200);
                        }
                    }
                } catch (error) {
                    alert('‚ùå Chyba pri importovan√≠ s√∫boru!');
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        });

        // Detekcia offline/online stavu
        window.addEventListener('online', () => updateStatus('‚úì Online - pripojen√© k internetu'));
        window.addEventListener('offline', () => updateStatus('‚ö† Offline - funguje lok√°lne'));
    </script>
</body>
</html>
